import os
import json
from worker import agent_invocation

# El payload que nos proporcionaste
payload = {'action': 'regenerate_merge', 'project_id': 'bf3c418c-c33b-45b6-a95e-c32f4af9c3ce', 'instructions': '', 'page_number': None, 'world_model_summary': None, 'panels': [{'id': 1472, 'page_number': 1, 'order_in_page': 2, 'prompt': "**Prompt:** A close-up manga-style illustration focusing on a hand poised over the power button located in the corner of a sleek white gaming monitor. The monitor is illuminated, casting a warm glow that highlights the whimsical details of the cozy room, such as colorful fairy lights and posters of video games in the background. The angle captures the excitement of the moment as the hand presses the button, emphasizing the dynamic character expression of anticipation. The cozy room atmosphere remains vibrant and youthful, with soft shading and playful line work enhancing the emotional storytelling. The bed is no longer visible, allowing the viewer to concentrate on the interaction with the gaming setup. The overall aesthetic continues to reflect an organic comic book style, showcasing the essence of a teenager's escape into gaming.", 'scene_description': 'Al centro del escritorio, una computadora blanca encendiéndose y una mano sobre el botón de encendido del monitor blanco. La computadora es de estilo gamer. Hay una webcam encima de la pantalla del monitor.', 'image_url': 'generated/6b666d82-41f0-45c4-a497-9a604dd4e70d.png', 'status': 'completed', 'balloons': [], 'layout': {'h': 14.394384461046467, 'w': 35.649643758666635, 'x': 64.43564998982784, 'y': 72.51139537221259}, 'character_refs': []}, {'id': 1470, 'page_number': 1, 'order_in_page': 0, 'prompt': "Exterior view of a condominium building in Los Olivos, Lima, Peru, illuminated by warm white light during the night. The 5th floor window glows softly, while all other windows are dark, emphasizing a cozy urban atmosphere. The scene captures the vibrant colors and whimsical background typical of manga style, with soft shading and playful line work. The focus remains on the building's architecture, highlighting its realistic design as a Lima condominium, while still maintaining an organic comic book aesthetic. The panel is designed in a 1:1 aspect ratio, ensuring a balanced composition. No characters are present in the scene, allowing the viewer to focus solely on the illuminated window and the dynamic urban setting.", 'scene_description': 'Se ve la habitación de Marie por fuera, encendida (Luz blanca) en medio de la noche. En un condominio de 6 pisos, algunos de los demás pisos también se encuentran encendidos. Ella vive en el 5to piso.', 'image_url': 'generated/127e9c33-d217-47ba-8f79-7fead96c88ee.png', 'status': 'completed', 'balloons': [{'x': 6.543053070487478, 'y': 22, 'text': 'Es de noche en Los Olivos. La habitación de Marie brilla en el quinto piso del condominio.', 'type': 'narration', 'width': 284, 'height': 64, 'fontSize': 13, 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 94.09027712381247, 'w': 94.0902771238125, 'x': -2.428545648620069, 'y': 3.018867924528302}, 'character_refs': []}, {'id': 1471, 'page_number': 1, 'order_in_page': 1, 'prompt': "**Prompt:** A close-up view of a cozy, cluttered desk interior, focusing on the messy arrangement of science books and scattered snack remnants. The can of Rika Cocola is prominently featured, capturing the vibrant colors and playful line work characteristic of manga style. The warm, inviting light continues to bathe the scene, enhancing the youthful aesthetic. The whimsical posters on the walls are still visible in the background, but the angle is now more direct, eliminating any characters from the scene. The floor remains scattered with game controllers, emphasizing the creative chaos of a teenager's sanctuary. The overall composition maintains the dynamic perspective and soft shading, reflecting an organic comic book aesthetic.", 'scene_description': 'En el interior de la habitación, se muestra un escritorio con algunos libros apilados de forma desordenada y restos de snacks por doquier. Los libros son de ciencias. También está presente la bebida Rika Cocola.', 'image_url': 'generated/4e75222c-b8c3-45f4-869d-4156c811ef60.png', 'status': 'completed', 'balloons': [], 'layout': {'h': 18.780516226718223, 'w': 36.06594242851129, 'x': 63.476144174564894, 'y': 51.361444206837035}, 'character_refs': []}, {'id': 1468, 'page_number': 2, 'order_in_page': 2, 'prompt': '**Prompt Visual Final:**\n\n"Close-up panel of a vibrant manga-style comic scene focusing on Peggy\'s hand as she presses the power button on an RGB light controller in Marie\'s room. The hand is depicted with dynamic lines and soft shading, showcasing her playful energy. The background remains whimsical, filled with colorful LED lights and posters of video games, but now the focus is entirely on the hand and the glowing button, emphasizing the action. The composition captures the excitement of the moment, with vibrant colors enhancing the youthful aesthetic. The detailed design of the hand reflects Peggy\'s character, maintaining the emotional storytelling of the urban setting while shifting the perspective to highlight this specific interaction."', 'scene_description': 'Una mano presionando el botón de encendido de un control de luces RGB.', 'image_url': 'generated/11547f1e-ddda-42c8-a66a-1d6913be288b.png', 'status': 'completed', 'balloons': [{'x': 32.000000000000114, 'y': 458.9999999999998, 'text': '¡LUCES!', 'type': 'dialogue', 'width': 165, 'height': 47, 'fontSize': 20, 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'x': 90, 'y': 133, 'text': '*presionar*', 'type': 'narration', 'width': 116, 'height': 40, 'fontSize': 13, 'character': None, 'position_hint': 'top-left'}], 'layout': {'h': 49.99999999999998, 'w': 30.526315789473713, 'x': 68.28947368421055, 'y': -0.7547169811320973}, 'character_refs': []}, {'id': 1466, 'page_number': 2, 'order_in_page': 0, 'prompt': '**Prompt Visual Final:**\n\n"Peggy, a young Peruvian girl with messy dark brown hair and honey-colored eyes, sits energetically in a vibrant fuchsia and white gaming chair. She wears a yellow sweater featuring a video game controller design and the text \'GAMER GIRL\', paired with playful pink polka-dotted socks. Sin embargo, su expresión ha cambiado a una de concentración, reflejando su enfoque mientras se prepara para comenzar un juego competitivo. El fondo sigue siendo la habitación de Marie, llena de detalles caprichosos como carteles de videojuegos y gadgets coloridos, sin el ardilla que estaba presente anteriormente. El panel se mantiene en un estilo manga, con un sombreado suave y expresiones dinámicas de los personajes, capturando la estética juvenil. La iluminación es brillante y alegre, pero ahora se centra en resaltar la seriedad de Peggy en lugar de su alegría. El ángulo de la cámara sigue siendo ligeramente inclinado desde arriba, creando una perspectiva dinámica que atrae al espectador a la escena, mientras se mantiene la relación de aspecto de 9:16."', 'scene_description': 'Peggy se sienta sobre su cómoda silla gamer de colores fucsia con blanco.', 'image_url': 'generated/ba1b5fd4-111b-4317-a3e9-3a5a6c686f6f.png', 'status': 'completed', 'balloons': [{'x': 29.50000000000003, 'y': 449.99999999999955, 'text': '¡SILLA!', 'type': 'dialogue', 'width': 183, 'height': 52, 'fontSize': 21, 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'x': 25, 'y': 38, 'text': '*se sienta*', 'type': 'narration', 'width': 179, 'height': 51, 'fontSize': 21, 'character': None, 'position_hint': 'top-left'}], 'layout': {'h': 49.99999999999996, 'w': 29.605263157894747, 'x': -1.3157894736842104, 'y': -0.3773584905660431}, 'character_refs': []}, {'id': 1469, 'page_number': 2, 'order_in_page': 3, 'prompt': '**Prompt Visual Final:**\n\n"Full-body shot of Peggy in her vibrant bedroom, showcasing a look of concentration and impatience as she grips a computer mouse with her right hand. Now, her left hand is raised, forming a fist, emphasizing her determination. The perspective remains from the computer screen, capturing the dynamic atmosphere. The room is still illuminated with purple, pink, and fuchsia lights, enhancing the whimsical feel. A poster of Nikola Tesla adorns the wall, while various gaming consoles are neatly arranged on a shelf. Peggy, a young Peruvian girl with messy dark brown hair and honey-colored eyes, wears a casual yellow sweater featuring a video game controller design and the text \'GAMER GIRL\'. Her playful expression radiates energy, complemented by pink polka-dotted socks. The scene continues to embody a manga style with vibrant colors, soft shading, and detailed character design, set in an urban environment, reflecting her fun and sarcastic personality."', 'scene_description': 'Peggy se ve a cuerpo completo en su habitación con una expresión de concentración e impaciencia, con la mano en el mouse. La vista es desde la computadora. Se observa un póster de Nikola Tesla en la pared y unas consolas de videojuegos en un estante. Las luces del ambiente se tornan morados, rosados y fucsia.', 'image_url': 'generated/b65f109d-6b97-45b7-be55-031de12802ce.png', 'status': 'completed', 'balloons': [{'x': 508.0000000000002, 'y': 25.000000000000114, 'text': '¡A POR EL NUEVO PASE DE BATALLA!', 'type': 'dialogue', 'width': 222, 'height': 73, 'fontSize': 20, 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 50.000000000000014, 'w': 98.15789473684217, 'x': 0.9210526315789472, 'y': 50.84905660377357}, 'character_refs': []}, {'id': 1467, 'page_number': 2, 'order_in_page': 1, 'prompt': '**Prompt Visual Final:**\n\n"Create a vibrant manga-style comic panel featuring Peggy, a young Peruvian girl with messy dark brown hair and honey-colored eyes. She is wearing a casual yellow sweater with a video game controller design and the text \'GAMER GIRL\', paired with pink polka-dotted socks. Peggy is now focused and concentrating as she prepares to play her competitive game, placing headphones with cat ears on her head. Her expression radiates determination instead of joy, reflecting her competitive spirit. The background has been cleaned up to create a more organized look, with fewer distractions, while still depicting her whimsical room filled with gaming posters and colorful gadgets, softly illuminated to maintain a warm atmosphere. Notably, she now has a single white computer monitor in front of her, and all cables have been removed for a tidier appearance. The logo of Cubers in the upper corner has been removed, allowing for a cleaner look. The panel should be 33.55% wide and 50% high (9:16 aspect ratio), capturing dynamic character expressions and detailed designs, while maintaining an organic comic book aesthetic."', 'scene_description': 'Ella se coloca audífonos con orejas sobre su cabeza con cabello ligeramente ondeado.', 'image_url': 'generated/391bd047-1260-4620-8275-c117069472ed.png', 'status': 'completed', 'balloons': [{'x': 37.50000000000013, 'y': 445.0000000000001, 'text': '¡AUDÍFONOS!', 'type': 'dialogue', 'width': 183, 'height': 47, 'fontSize': 20, 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 50.000000000000014, 'w': 33.5526315789474, 'x': 31.184210526315777, 'y': 0.37735849056603776}, 'character_refs': []}], 'global_context': {'style_guide': 'Estilo manga a color juvenil', 'characters': [{'name': 'Marie', 'description': 'Nombre:\tMarie Rosas\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t07/11/2000\r\nEspecialidad:\t3x3, Megaminx, Square-1, cuboides\r\nCaracterísticas:\tCabello largo, naturalmente ondeado pero le gusta plancharlo, viste chompas o poleras manga larga y pantalones jean.\r\nPersonalidad:\r\nCuriosa, investigadora, gamer, tímida, sencilla, bromista y algo soberbia. El horrible pasado con su padre y las tendencias suicidas la atormentan. Sufre de TID (Transtorno de identidad disociativo) que la lleva a tener 5 personalidades, de las cuales solo es consciente de 3. Una decepción amorosa endurece su corazón. Le gusta comer, ver películas, series, la ciencia y sobretodo le llaman mucho la atención los cubos más extraños. Posee lagunas mentales\r\n', 'metadata': {}, 'image_url': 'https://s3-draft-comic-main-bucket.s3.amazonaws.com/projects/bf3c418c-c33b-45b6-a95e-c32f4af9c3ce/characters/Marie_Rosas.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIA5V7ZGRLYL3GSHDVA%2F20260214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260214T170527Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=c418f6de24e1f5eaf9c01662ce531a3d256aba2f2178ea5c2bdee792b476944d'}, {'name': 'Peggy', 'description': 'Nombre:\tPeggy Fresa\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t08/12/2002\r\nEspecialidad:\tVideojuegos, Matanite.\r\nCaracterísticas:\tDespeinada y descuidada. Usa gadgets tecnológicos.\r\nPersonalidad:\r\nSiempre divertida y sarcástica. Trata de ser ruda pero no es lo suficiente. Se concentra y enoja exageradamente al jugar videojuegos, pero es de las mejores. Le encantan los animales.', 'metadata': {}, 'image_url': 'https://s3-draft-comic-main-bucket.s3.amazonaws.com/projects/bf3c418c-c33b-45b6-a95e-c32f4af9c3ce/characters/DdP_Peggy_Fresa_1.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIA5V7ZGRLYL3GSHDVA%2F20260214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260214T170527Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=9a04431f0ab34e6bf5aeb157216000f48bed70705f1adcad5db228416bdcdee2'}], 'sceneries': [{'name': 'Casa de Marie', 'description': 'Condominio color crema de 6 pisos y Marie Vive en el 5to piso', 'metadata': {}, 'image_url': ''}, {'name': 'Habitación de Marie', 'description': 'Cuarto con posters en las paredes, desorden en el escritorio pero todo lo demás limpio. Cama destendida en el centro. Computadora gamer blanca en su escritorio.', 'metadata': {}, 'image_url': ''}]}}

def run_test():
    print("Iniciando prueba local del agente...")
    # El contexto puede ser un objeto vacío para simular Lambda/Bedrock
    context = {}
    
    result = agent_invocation(payload, context)
    
    print("\n--- RESULTADO DEL AGENTE ---")
    print(json.dumps(result, indent=2))

if __name__ == "__main__":
    run_test()
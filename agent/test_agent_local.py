import os
import json
from worker import agent_invocation

# El payload que nos proporcionaste
payload = {'action': 'regenerate_panel', 'project_id': 'bf3c418c-c33b-45b6-a95e-c32f4af9c3ce', 'panel_id': 1461, 'prompt': 'Close-up shot of a sleek white gaming monitor on a modern desk, with the focus now on a hand where the index finger is pressing the power button located in the lower corner of the monitor. The monitor glows as it powers on, and a stylish webcam sits atop it. The scene remains vibrant and colorful, illustrated in a youthful manga style. Dynamic lighting highlights the contours of the monitor and the hand, emphasizing the moment of activation. The panel dimensions are 46.24% width x 18.06% height (16:9 aspect ratio).', 'scene_description': 'Al centro del escritorio, una computadora blanca encendiéndose y una mano sobre el botón de encendido del monitor blanco. La computadora es de estilo gamer. Hay una webcam encima de la pantalla del monitor.', 'balloons': [{'text': 'Una computadora gamer se enciende, lista para la acción.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'panel_style': 'Manga comic a color. Ilustración', 'instructions': 'El close up debería se mayor', 'current_image_url': 'https://s3-draft-comic-main-bucket.s3.amazonaws.com/generated/a3966544-f339-45b2-ab44-12a10583881e.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIA5V7ZGRLYL3GSHDVA%2F20260214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260214T051117Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=92e379a2d258a0aeedebf863a9a6cb3a05451ba720b177c6f1a92f2921b89849', 'reference_image_url': None, 'panels': [{'id': 1459, 'page_number': 1, 'order_in_page': 0, 'prompt': '"Exterior view of Marie\'s room at night, illuminated by soft white light, located on the 5th floor of a six-story condominium in Los Olivos. The building features a mix of lit and unlit windows, creating a cozy urban atmosphere. The scene captures a vibrant manga style with dynamic colors, showcasing whimsical backgrounds and soft shading. The angle is slightly tilted upward, emphasizing the height of the building and the glow from Marie\'s window, evoking a sense of warmth and solitude. The overall aesthetic is youthful and playful, with an emotional depth that hints at Marie\'s inner world."', 'scene_description': 'Se ve la habitación de Marie por fuera, encendida (Luz blanca) en medio de la noche. En un condominio de 6 pisos, algunos de los demás pisos también se encuentran encendidos. Ella vive en el 5to piso.', 'image_url': 'generated/a26a0b7b-2c98-4ca7-a067-c64955e159a1.png', 'status': 'completed', 'balloons': [{'text': 'Es de noche en Los Olivos. La habitación de Marie brilla en el quinto piso del condominio.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 95.03142675000211, 'w': 95.03142675000214, 'x': 0.9210525613082117, 'y': 2.1698113207547167}, 'character_refs': []}, {'id': 1455, 'page_number': 2, 'order_in_page': 0, 'prompt': '**Prompt Visual Final:**\n\n"Create a vibrant manga-style comic panel featuring Peggy, a young Peruvian girl with messy short dark brown hair and honey-colored eyes, sitting on a comfortable fuchsia and white gamer chair in Marie\'s bedroom. She wears a yellow sweater with a video game controller design and the text \'GAMER GIRL\', paired with pink polka-dotted socks. Her expression is playful and sarcastic, with an intense focus as she plays video games. The room is filled with whimsical elements, like posters of video games and colorful gadgets, reflecting her youthful aesthetic. Use soft shading for depth and ensure dynamic character expressions. The panel should be 30.79% wide and 50% high (9:16 aspect ratio), with warm lighting to create an inviting atmosphere, and a slightly low-angle perspective to emphasize Peggy\'s energetic posture."', 'scene_description': 'Peggy se sienta sobre su cómoda silla gamer de colores fucsia con blanco.', 'image_url': 'generated/b4fd4a83-3d7a-4025-ac25-d07bec998625.png', 'status': 'completed', 'balloons': [{'text': '¡SILLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'text': '*se sienta*', 'type': 'narration', 'character': None, 'position_hint': 'top-left'}], 'layout': {'h': 50.000000000000014, 'w': 30.78947514985726, 'x': -1.5789472479569386, 'y': 1.3207547169811322}, 'character_refs': []}, {'id': 1460, 'page_number': 1, 'order_in_page': 1, 'prompt': '"Inside a cluttered room, a messy desk is filled with stacked science books and scattered snack remnants, creating a chaotic yet vibrant atmosphere. A can of Rika Cocola sits prominently on the desk. The scene is illustrated in a manga style with vibrant colors and a youthful aesthetic. Soft shading enhances the whimsical background, while dynamic expressions are implied through the arrangement of objects. The lighting is warm and inviting, casting soft shadows that add depth to the urban setting. The panel is designed in a 16:9 aspect ratio, capturing the emotional depth of Marie\'s world without any characters present."', 'scene_description': 'En el interior de la habitación, se muestra un escritorio con algunos libros apilados de forma desordenada y restos de snacks por doquier. Los libros son de ciencias. También está presente la bebida Rika Cocola.', 'image_url': 'generated/4a123e90-d122-45ed-b64c-254b9ad5bfa7.png', 'status': 'completed', 'balloons': [{'text': 'El interior de la habitación está desordenado, con libros de ciencias y restos de snacks por doquier.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 16.505291258284945, 'w': 39.582825189552175, 'x': 57.654017126522895, 'y': 39.62678421341314}, 'character_refs': []}, {'id': 1456, 'page_number': 2, 'order_in_page': 1, 'prompt': '**Prompt Visual Final:**\n\n"Create a vibrant manga-style comic panel featuring Peggy, a young Peruvian girl with messy, short dark brown hair and honey-colored eyes. She is wearing a casual yellow sweater with a video game controller design and the text \'GAMER GIRL\', paired with pink polka-dotted socks. Peggy is sitting in Marie\'s bedroom, placing headphones with cat ears on her head, her expression playful and slightly sarcastic. The room is filled with whimsical details like posters of video games, a cluttered desk with gadgets, and soft, warm lighting that creates a cozy atmosphere. Capture her relaxed yet intense posture as she prepares to dive into a video game, emphasizing her youthful energy and emotional depth. Use dynamic angles to enhance the scene, focusing on her face and the headphones, while maintaining an organic comic book aesthetic."', 'scene_description': 'Ella se coloca audífonos con orejas sobre su cabeza con cabello ligeramente ondeado.', 'image_url': 'generated/077c04fc-8595-4b80-a73a-f1f69ae109de.png', 'status': 'completed', 'balloons': [{'text': '¡AUDÍFONOS!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 49.99999999999998, 'w': 30.52631727519779, 'x': 32.89473814713318, 'y': -1.037735849056609}, 'character_refs': []}, {'id': 1461, 'page_number': 1, 'order_in_page': 2, 'prompt': 'Close-up shot of a sleek white gaming monitor on a modern desk, with the focus now on a hand where the index finger is pressing the power button located in the lower corner of the monitor. The monitor glows as it powers on, and a stylish webcam sits atop it. The scene remains vibrant and colorful, illustrated in a youthful manga style. Dynamic lighting highlights the contours of the monitor and the hand, emphasizing the moment of activation. The panel dimensions are 46.24% width x 18.06% height (16:9 aspect ratio).', 'scene_description': 'Al centro del escritorio, una computadora blanca encendiéndose y una mano sobre el botón de encendido del monitor blanco. La computadora es de estilo gamer. Hay una webcam encima de la pantalla del monitor.', 'image_url': 'generated/a3966544-f339-45b2-ab44-12a10583881e.png', 'status': 'completed', 'balloons': [{'text': 'Una computadora gamer se enciende, lista para la acción.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 18.058579000029894, 'w': 46.2369414010427, 'x': 53.40111522301797, 'y': 61.181886869961446}, 'character_refs': []}, {'id': 1458, 'page_number': 2, 'order_in_page': 3, 'prompt': "Full-body shot of Peggy in her bedroom, showcasing a look of concentration and impatience as she grips a mouse. The perspective is from her computer, emphasizing her focus. The room features a Nikola Tesla poster on the wall and shelves lined with video game consoles. The ambient lighting is a vibrant mix of purple, pink, and fuchsia, creating a whimsical atmosphere. Peggy, a young Peruvian girl, has messy, short dark brown hair with strands falling over her forehead. She wears a comfortable yellow sweater with a video game controller design and the text 'GAMER GIRL', paired with pink polka-dotted socks. Her expression is playful yet intense, reflecting her gamer spirit. The panel is designed in a manga style with vibrant colors, dynamic character expressions, and soft shading, maintaining an organic comic book aesthetic. The third hand and the bag of chips have been removed, allowing Peggy's focus on the mouse to be even more pronounced. Aspect ratio 16:9.", 'scene_description': 'Peggy se ve a cuerpo completo en su habitación con una expresión de concentración e impaciencia, con la mano en el mouse. La vista es desde la computadora. Se observa un póster de Nikola Tesla en la pared y unas consolas de videojuegos en un estante. Las luces del ambiente se tornan morados, rosados y fucsia.', 'image_url': 'generated/aa964775-0f5d-4c51-98a0-9ebe4e5f3322.png', 'status': 'completed', 'balloons': [{'text': '¡A POR EL NUEVO PASE DE BATALLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'text': 'Las luces del ambiente se tornan morados, rosados y fucsia, creando una atmósfera de emoción.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 49.99999999999996, 'w': 99.99999618530295, 'x': 0.6578985013456942, 'y': 51.41509433962259}, 'character_refs': []}, {'id': 1457, 'page_number': 2, 'order_in_page': 2, 'prompt': '**Prompt Visual Final:**\n\n"Inside Marie\'s room, a vibrant manga-style scene featuring Peggy, a young Peruvian girl with messy, short dark brown hair and honey-colored eyes. She is pressing the power button on an RGB light controller, her expression playful and sarcastic, embodying a relaxed yet energetic posture. She wears a comfortable yellow sweater with a video game controller design and the text \'GAMER GIRL\', paired with pink polka-dotted socks. The room is filled with whimsical backgrounds, showcasing gaming posters and colorful gadgets. The lighting is dynamic, with the RGB lights casting a soft, colorful glow that highlights Peggy\'s features and adds depth to the scene. The camera angle is slightly low, emphasizing her action and creating a sense of immersion in her playful world. The panel is designed in a 9:16 aspect ratio, capturing the youthful aesthetic and emotional depth of the moment."', 'scene_description': 'Una mano presionando el botón de encendido de un control de luces RGB.', 'image_url': 'generated/db440a92-701f-4227-939b-e841467cd89d.png', 'status': 'completed', 'balloons': [{'text': '¡LUCES!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'text': '*presionar*', 'type': 'narration', 'character': None, 'position_hint': 'top-left'}], 'layout': {'h': 50, 'w': 29.736843651219257, 'x': 68.8157842234565, 'y': 1.0725173369963777e-14}, 'character_refs': []}], 'global_context': {'style_guide': 'Estilo manga a color juvenil', 'characters': [{'name': 'Marie', 'description': 'Nombre:\tMarie Rosas\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t07/11/2000\r\nEspecialidad:\t3x3, Megaminx, Square-1, cuboides\r\nCaracterísticas:\tCabello largo, naturalmente ondeado pero le gusta plancharlo, viste chompas o poleras manga larga y pantalones jean.\r\nPersonalidad:\r\nCuriosa, investigadora, gamer, tímida, sencilla, bromista y algo soberbia. El horrible pasado con su padre y las tendencias suicidas la atormentan. Sufre de TID (Transtorno de identidad disociativo) que la lleva a tener 5 personalidades, de las cuales solo es consciente de 3. Una decepción amorosa endurece su corazón. Le gusta comer, ver películas, series, la ciencia y sobretodo le llaman mucho la atención los cubos más extraños. Posee lagunas mentales\r\n', 'metadata': {}}, {'name': 'Peggy', 'description': 'Nombre:\tPeggy Fresa\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t08/12/2002\r\nEspecialidad:\tVideojuegos, Matanite.\r\nCaracterísticas:\tDespeinada y descuidada. Usa gadgets tecnológicos.\r\nPersonalidad:\r\nSiempre divertida y sarcástica. Trata de ser ruda pero no es lo suficiente. Se concentra y enoja exageradamente al jugar videojuegos, pero es de las mejores. Le encantan los animales.', 'metadata': {}}], 'sceneries': [{'name': 'Casa de Marie', 'description': 'Condominio color crema de 6 pisos y Marie Vive en el 5to piso', 'metadata': {}}, {'name': 'Habitación de Marie', 'description': 'Cuarto con posters en las paredes, desorden en el escritorio pero todo lo demás limpio. Cama destendida en el centro. Computadora gamer blanca en su escritorio.', 'metadata': {}}]}}

def run_test():
    print("Iniciando prueba local del agente...")
    # El contexto puede ser un objeto vacío para simular Lambda/Bedrock
    context = {}
    
    result = agent_invocation(payload, context)
    
    print("\n--- RESULTADO DEL AGENTE ---")
    print(json.dumps(result, indent=2))

if __name__ == "__main__":
    run_test()
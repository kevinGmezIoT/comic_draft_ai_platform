import os
import json
from worker import agent_invocation

# El payload que nos proporcionaste
payload = {'action': 'regenerate_panel', 'project_id': 'acae7fb9-a851-4a06-9be3-daaed97da4c0', 'panel_id': 1477, 'page_number': 2, 'prompt': '**Prompt Visual Final:**\n\n"Inside a cozy bedroom, Peggy Fresa, a 21-year-old Peruvian girl with messy dark brown hair and honey-colored eyes, sits on a vibrant pink and white gaming chair. She wears a yellow sweater with a video game controller graphic and the phrase \'Gamer Girl\', paired with pink polka-dotted socks. The room is softly lit, showcasing a white desk with a glowing white gaming PC, a pink gaming mouse, and a purple backlit keyboard. A large window with white frames allows gentle night light to filter in, illuminating posters of video games and Rubik\'s cubes on the walls. The atmosphere is youthful and creative, with a pastel color palette and organized desk space. Peggy\'s expression is friendly yet competitive, reflecting her playful personality as she prepares to play video games. The camera angle captures her from a slightly low perspective, emphasizing her dynamic presence in the room, with a focus on her engaging expression and the vibrant details of her surroundings."', 'scene_description': 'Peggy se sienta sobre su cómoda silla gamer de colores fucsia con blanco.', 'balloons': [{'text': '¡SILLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'panel_style': '', 'instructions': 'Elimina los bordes color negro superior e inferior. Este panel debe ser vertical y sobretodo enfocado en Peggy sentándose en su silla', 'current_image_url': 'generated/1a6f41a9-2fc3-4a5b-b8bb-e059c17b7703.png', 'reference_image_url': None, 'panels': [{'id': 1483, 'page_number': 1, 'order_in_page': 2, 'prompt': '**Prompt Visual Final:**\n\n"Close-up of a hand poised over the power button of a white gamer PC, with the monitor slightly visible in the background, still dark. The hand is delicately hovering above the button, creating a sense of anticipation. The cozy bedroom setting remains intact, featuring the white desk with a pink desk mat, a white keyboard with purple backlight, and a pink gaming mouse. The webcam is still positioned above the monitor. The room is softly illuminated by the ambient white light from the desk, with purple neon accents enhancing the vibrant atmosphere. The walls continue to display posters of video games and Rubik\'s cubes, while the large window with multiple panes reveals the night sky outside. The pastel color palette and the plants on the windowsill are preserved, along with the pink gaming chair nearby. This close-up angle emphasizes the hand and the power button, capturing the youthful energy and excitement of starting a gaming session."', 'scene_description': 'Al centro del escritorio, una computadora blanca encendiéndose y una mano sobre el botón de encendido del monitor blanco. La computadora es de estilo gamer. Hay una webcam encima de la pantalla del monitor.', 'image_url': 'generated/0ec7f608-d365-4e7e-8d3c-f1d0da004d1f.png', 'status': 'completed', 'balloons': [], 'layout': {'h': 13.45829427113758, 'w': 38.765738933168166, 'x': 60.707945277358114, 'y': 79.18321516282457}, 'character_refs': []}, {'id': 1480, 'page_number': 2, 'order_in_page': 3, 'prompt': "**Prompt Visual Final:**\n\nA full-body view of Peggy Fresa in her cozy bedroom, standing in front of her white gaming PC with a focused and impatient expression, hand on the pink gaming mouse. The scene is from the computer's perspective, showcasing a vibrant color palette with purple, pink, and fuchsia ambient lighting. The walls are adorned with a Nikola Tesla poster and shelves filled with video game consoles and books, reflecting her youthful and creative personality. The room features a large window with a white frame, soft pastel colors, and a cute aesthetic. Peggy has messy dark brown hair with bangs, honey-colored eyes, and a slim build. She wears a yellow sweater with a video game controller graphic and the phrase 'Gamer Girl', paired with pink polka-dotted socks. The desk is organized, with a white keyboard glowing in purple light and a pink gaming headset with cat ears resting nearby. The monitor displays a heart-shaped image, adding a personal touch to the scene. The overall atmosphere is dynamic and expressive, capturing the essence of a young gamer immersed in her world.", 'scene_description': 'Peggy se ve a cuerpo completo en su habitación con una expresión de concentración e impaciencia, con la mano en el mouse. La vista es desde la computadora. Se observa un póster de Nikola Tesla en la pared y unas consolas de videojuegos en un estante. Las luces del ambiente se tornan morados, rosados y fucsia.', 'image_url': 'generated/ace5b339-10d0-4879-9c94-e76448aad602.png', 'status': 'completed', 'balloons': [{'text': '¡A POR EL NUEVO PASE DE BATALLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 46.50943396226414, 'w': 100.92105263157907, 'x': -0.9210526315789472, 'y': 53.49056603773582}, 'character_refs': []}, {'id': 1479, 'page_number': 2, 'order_in_page': 2, 'prompt': "**Prompt Visual Final:**\n\nA cozy interior of Marie's bedroom at night, featuring a large window with multiple panes and a white frame. The room is softly lit with white and purple neon lighting, creating a warm atmosphere. In the center, a white gaming desk with a pink desk mat holds a glowing white keyboard and a pink gaming mouse. A pink gaming chair with cat ears is positioned in front of the desk. On the monitor, a heart-shaped image is displayed, while a webcam sits atop it. Books are haphazardly stacked on the desk alongside snacks and a Rika Cocola drink. \n\nIn the foreground, Peggy Fresa, a 21-year-old Peruvian girl with messy dark brown hair and honey-colored eyes, sits in the pink gaming chair. She wears a yellow sweater with a video game controller graphic and the phrase 'Gamer Girl', paired with pink polka-dotted socks. Her expression is friendly yet competitive, embodying her fun and sarcastic personality. The walls are adorned with posters of video games and Rubik's cubes, and plants sit on the windowsill, enhancing the youthful and creative vibe of the room. The RGB lights are activating, casting vibrant colors across the scene. The camera angle is slightly low, emphasizing Peggy's dynamic pose as she presses the power button on the RGB light controller, capturing the moment of excitement and anticipation. \n\n**Art Style:** Clean line art, vibrant color palette, soft shading, dynamic panel layouts, flat colors, expressive character designs, bright highlights, minimalist backgrounds, organic comic book aesthetic.", 'scene_description': 'Una mano presionando el botón de encendido de un control de luces RGB.', 'image_url': 'generated/ab4507dc-1150-4571-bbfe-607d0c905e56.png', 'status': 'completed', 'balloons': [{'text': '¡LUCES!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 49.99999999999998, 'w': 28.42105263157892, 'x': 71.84210526315789, 'y': 2.075471698113186}, 'character_refs': []}, {'id': 1482, 'page_number': 1, 'order_in_page': 1, 'prompt': '**Prompt Visual Final:**\n\n"Interior of Marie\'s cozy bedroom at night, featuring a white desk cluttered with stacked science books, snack remnants, and a Rika Cocola drink. The room is softly lit with white light, highlighting a pink gaming chair. A large window with multiple panes reveals a night sky outside. The walls are adorned with colorful posters of video games and Rubik\'s cubes, creating a youthful and creative atmosphere. The scene captures a dynamic angle, focusing on the desk and the vibrant colors of the room, with soft shading and bright highlights to enhance the organic comic book aesthetic. The white gaming PC has been removed from the scene, emphasizing the disarray of the desk and the personal touches in Marie\'s space. The layout remains in a 16:9 aspect ratio."', 'scene_description': 'En el interior de la habitación, se muestra un escritorio con algunos libros apilados de forma desordenada y restos de snacks por doquier. Los libros son de ciencias. También está presente la bebida Rika Cocola.', 'image_url': 'generated/82956ba2-674d-4ec2-a9b3-b56424b3fc9c.png', 'status': 'completed', 'balloons': [], 'layout': {'h': 18.018867924528315, 'w': 49.99999999999995, 'x': 50.9210526315789, 'y': 58.679245283018865}, 'character_refs': []}, {'id': 1478, 'page_number': 2, 'order_in_page': 1, 'prompt': '**Prompt Visual Final:**\n\n"Interior of Marie\'s cozy bedroom at night, featuring a large window with multiple panes and a white frame. The room is softly lit with white light, creating a warm atmosphere. In the center, a white gaming desk with a pink desk mat holds a glowing white keyboard with purple backlight, a pink gaming mouse, and a pink computer tower with a glass side panel. A monitor displays a heart-shaped image. Now, only Peggy, a 21-year-old friend with messy dark brown hair and honey-colored eyes, is present in the scene. She is placing pink cat-ear headphones over her head, her expression playful yet competitive. She wears a yellow sweater with a video game controller design and the phrase \'Gamer Girl.\' The background remains unchanged, with walls adorned with posters of video games and Rubik\'s cubes, and a shelf filled with books and toys, maintaining the creative vibe. The room is decorated with pastel colors, plants on the windowsill, and a cute aesthetic, capturing the essence of a vibrant, youthful comic manga style. Panel layout: 35.26315789473687% width x 50% height (9:16)."', 'scene_description': 'Ella se coloca audífonos con orejas sobre su cabeza con cabello ligeramente ondeado.', 'image_url': 'generated/2778ef5f-198c-478b-9f27-bddaa381e1ed.png', 'status': 'completed', 'balloons': [{'text': '¡AUDÍFONOS!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 50, 'w': 35.26315789473687, 'x': 31.973684210526322, 'y': 0.2830188679245283}, 'character_refs': []}, {'id': 1477, 'page_number': 2, 'order_in_page': 0, 'prompt': '**Prompt Visual Final:**\n\n"Inside a cozy bedroom, Peggy Fresa, a 21-year-old Peruvian girl with messy dark brown hair and honey-colored eyes, sits on a vibrant pink and white gaming chair. She wears a yellow sweater with a video game controller graphic and the phrase \'Gamer Girl\', paired with pink polka-dotted socks. The room is softly lit, showcasing a white desk with a glowing white gaming PC, a pink gaming mouse, and a purple backlit keyboard. A large window with white frames allows gentle night light to filter in, illuminating posters of video games and Rubik\'s cubes on the walls. The atmosphere is youthful and creative, with a pastel color palette and organized desk space. Peggy\'s expression is friendly yet competitive, reflecting her playful personality as she prepares to play video games. The camera angle captures her from a slightly low perspective, emphasizing her dynamic presence in the room, with a focus on her engaging expression and the vibrant details of her surroundings."', 'scene_description': 'Peggy se sienta sobre su cómoda silla gamer de colores fucsia con blanco.', 'image_url': 'generated/1a6f41a9-2fc3-4a5b-b8bb-e059c17b7703.png', 'status': 'completed', 'balloons': [{'text': '¡SILLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 49.99999999999994, 'w': 29.34210526315789, 'x': -0.9210526315789437, 'y': 3.0188679245282963}, 'character_refs': []}, {'id': 1481, 'page_number': 1, 'order_in_page': 0, 'prompt': "**Prompt:** A cozy six-story condominium in Los Olivos, Lima, Peru, at night. The building has a light green and white facade, with rectangular windows and small balconies. The 5th floor apartment of Marie is illuminated with bright white light, contrasting against the dark night sky. Other floors also have some lights on, creating a warm ambiance. The scene captures the modern architecture with a minimalist design, surrounded by trees in the foreground. The angle is slightly tilted upward, focusing on Marie's lit window, emphasizing the vibrant colors and soft shading typical of a youthful comic manga style. The overall atmosphere is inviting yet reflective, hinting at Marie's inner world.", 'scene_description': 'Se ve la habitación de Marie por fuera, encendida (Luz blanca) en medio de la noche. En un condominio de 6 pisos, algunos de los demás pisos también se encuentran encendidos. Ella vive en el 5to piso.', 'image_url': 'generated/c5131026-c12d-4bb3-83eb-a468a3f99ad8.png', 'status': 'completed', 'balloons': [{'text': 'Es de noche en Los Olivos. La habitación de Marie brilla en el quinto piso del condominio.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 93.9031373307852, 'w': 93.90313733078521, 'x': 2.631578947368421, 'y': 0.18867924528301888}, 'character_refs': []}], 'global_context': {'style_guide': 'Cómic Manga  a color juvenil, no hay elementos fantásticos.', 'characters': [{'name': 'Marie', 'description': 'Nombre:\tMarie Rosas\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t07/11/2000\r\nEspecialidad:\t3x3, Megaminx, Square-1, cuboides\r\nCaracterísticas:\tCabello largo, naturalmente ondeado pero le gusta plancharlo, viste chompas o poleras manga larga y pantalones jean.\r\nPersonalidad:\r\nCuriosa, investigadora, gamer, tímida, sencilla, bromista y algo soberbia. El horrible pasado con su padre y las tendencias suicidas la atormentan. Sufre de TID (Transtorno de identidad disociativo) que la lleva a tener 5 personalidades, de las cuales solo es consciente de 3. Una decepción amorosa endurece su corazón. Le gusta comer, ver películas, series, la ciencia y sobretodo le llaman mucho la atención los cubos más extraños. Posee lagunas mentales', 'metadata': {}}, {'name': 'Peggy', 'description': 'Nombre:\tPeggy Fresa\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t08/12/2002\r\nEspecialidad:\tVideojuegos, Matanite.\r\nCaracterísticas:\tDespeinada y descuidada. Usa gadgets tecnológicos.\r\nPersonalidad:\r\nSiempre divertida y sarcástica. Trata de ser ruda pero no es lo suficiente. Se concentra y enoja exageradamente al jugar videojuegos, pero es de las mejores. Le encantan los animales.', 'metadata': {}}], 'sceneries': [{'name': 'Casa de Marie', 'description': 'Condominio de 6 pisos donde Marie vive en el 5to piso. El edificio es color crema y se ubica en un barrio de los Olivos en Lima Perú', 'metadata': {}, 'image_url': 'https://s3-draft-comic-main-bucket.s3.amazonaws.com/projects/acae7fb9-a851-4a06-9be3-daaed97da4c0/sceneries/condominio.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIA5V7ZGRLYL3GSHDVA%2F20260215%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260215T185926Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=c0dae71fb12ec73e5b2dc4f4ddd9ac273e6026e6a526c5d29e6d5924453719dc'}, {'name': 'Interior habitación de Marie', 'description': 'Cuarto de chica donde hay una cama en el centro, un escritorio del lado de la pared donde hay una PC gamer blanca, también hay una silla gamer', 'metadata': {}, 'image_url': 'https://s3-draft-comic-main-bucket.s3.amazonaws.com/projects/acae7fb9-a851-4a06-9be3-daaed97da4c0/sceneries/habitacion.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIA5V7ZGRLYL3GSHDVA%2F20260215%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260215T185926Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=db536b6fb27d3bb89d37f75d13d693a5feecd89bb1329b597c1bca6b7cad0bde'}]}}

def run_test():
    print("Iniciando prueba local del agente...")
    # El contexto puede ser un objeto vacío para simular Lambda/Bedrock
    context = {}
    
    result = agent_invocation(payload, context)
    
    print("\n--- RESULTADO DEL AGENTE ---")
    print(json.dumps(result, indent=2))

if __name__ == "__main__":
    run_test()
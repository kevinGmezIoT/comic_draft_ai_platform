import os
import json
from worker import agent_invocation

# El payload que nos proporcionaste
payload = {
    'action': 'regenerate_merge', 
'project_id': 'c195e65c-601c-45cc-ac23-3e42696c31a1', 
'instructions': 'En esta página solo debería verse el condominio desde afuera y no estarán presente ni Peggy ni Marie', 
'page_number': 4, 
'world_model_summary': 'SYNOPSIS / DESCRIPTION: Marie, una adolescente con alters de personalidad, usa los videojuegos y el humor para evadir recuerdos traumáticos mientras vive su día a día escolar y la despedida de su mejor amiga Silvia. En el colegio conoce a Enrique, quien le enseña speedcubing; el cubo se vuelve una metáfora de su deseo de ordenar su mente y sus emociones. Con el tiempo, Marie se enamora de él y se prepara para un torneo, esperando confesarle sus sentimientos. Al descubrir que Enrique tiene pareja, sufre una fuerte crisis interna que culmina con la aparición de Tharpy, un nuevo alter protector que la salva de la autodestrucción.\n\nWORLD BIBLE: La historia se ubica en Los olivos, Lima Perú en 2013. Marie es una chica con TID donde una de sus personalidades es Peggy y se turnan para poseer su cuerpo. Al principio Marie tiene fascinación por la ciencia, literatura y Peggy es gamer.\n\nSTYLE GUIDE: Cómic Manga a color juvenil, dinámico pero sin fantasía.\n\nCHARACTERS:\n- Marie: Nombre:\tMarie Rosas\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t07/11/2000\r\nEspecialidad:\t3x3, Megaminx, Square-1, cuboides\r\nCaracterísticas:\tCabello largo, naturalmente ondeado pero le gusta plancharlo, viste chompas o poleras manga larga y pantalones jean.\r\nPersonalidad:\r\nCuriosa, investigadora, gamer, tímida, sencilla, bromista y algo soberbia. El horrible pasado con su padre y las tendencias suicidas la atormentan. Sufre de TID (Transtorno de identidad disociativo) que la lleva a tener 5 personalidades, de las cuales solo es consciente de 3. Una decepción amorosa endurece su corazón. Le gusta comer, ver películas, series, la ciencia y sobretodo le llaman mucho la atención los cubos más extraños. Posee lagunas mentales\n- Peggy: Nombre:\tPeggy Fresa\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t08/12/2002\r\nEspecialidad:\tVideojuegos, Matanite.\r\nCaracterísticas:\tDespeinada y descuidada. Usa gadgets tecnológicos.\r\nPersonalidad:\r\nSiempre divertida y sarcástica. Trata de ser ruda pero no es lo suficiente. Se concentra y enoja exageradamente al jugar videojuegos, pero es de las mejores. Le encantan los animales.\n\nSCENERIES:\n- Casa de Marie: Condominio de 6 pisos donde Marie vive en el 5to piso ubicado en un barrio en los olivos Lima Perú\n- Interior habitación de Marie: Cuarto de chica que tiene una cama central, un escritorio donde se ubica su computadora gamer color blanco y una silla gamer rosada', 'panels': [{'id': 1545, 'page_number': 3, 'order_in_page': 0, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Introducir el videojuego y su importancia. Emoción: Emoción y urgencia. Elemento visual: Pantalla del juego \'Matanite\'.\n\n**Prompt Visual Final:**\n\n"Interior of Marie\'s bedroom at night, featuring a computer screen displaying the game \'Matanite\' with a cubic character wielding a sword similar to Wanda\'s. The room is illuminated by a bright white light, casting soft shadows. The walls are adorned with a poster of Nikola Tesla, and a shelf filled with video game consoles is visible. A cluttered desk is in front of the computer, with disorganized stacks of books, snack remnants, and a Rika Cocola drink. A webcam sits atop the monitor. The scene captures a dynamic comic manga style with vibrant colors, clean outlines, and expressive poses, emphasizing the youthful atmosphere. The camera angle is slightly tilted to create a sense of depth, focusing on the computer screen while showcasing the chaotic yet cozy environment."', 'scene_description': "La computadora muestra el juego 'Matanite', Shooter en 3ra persona con personajes cúbicos. El personaje blanda una espada que es igual que la que utiliza Wanda al final.", 
'image_url': 'generated/2234af75-ded9-4042-96df-cf8d2a564ca7.png', 
'status': 'completed', 
'balloons': [
    {
        'text': "La pantalla muestra el juego 'Matanite' con un nuevo pase de batalla.", 
        'type': 'narration', 
        'character': None, 
        'position_hint': 
        'top-center'
        }
        ], 
        'layout': {'h': 21.61281365772429, 'w': 44.56713341939265, 'x': -9.349246523159212e-16, 'y': 0}, 
        'character_refs': []
        }, 
        {'id': 1531, 
        'page_number': 2, 
        'order_in_page': 1, 
        'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Mostrar la preparación de Peggy para jugar. Emoción: Entusiasmo. Elemento visual: Audífonos con orejas.\n\n**Prompt Visual Final:**\n\n"Inside Marie\'s bedroom at night, dynamic comic manga style, featuring Peggy Fresa, a 21-year-old personality of Marie, sitting in a vibrant pink and white gaming chair at her messy desk. She has slightly tousled hair and wears headphones with ears on her head. The room is illuminated by a bright white light from her gaming computer, casting soft shadows. The desk is cluttered with stacked books, snack remnants, and a Rika Cocola drink. A webcam sits atop the monitor. The background is minimalist, emphasizing Peggy\'s expressive pose as she intensely focuses on a video game, showcasing her competitive spirit. The overall color palette is vibrant with clean outlines and flat colors, capturing a youthful and organic comic book aesthetic."', 'scene_description': 'Ella se coloca audífonos con orejas sobre su cabeza con cabello ligeramente ondeado.', 'image_url': 'generated/ef6a52d1-ad89-4f18-be99-f9254321fd2c.png', 'status': 'completed', 'balloons': [{'text': '¡AUDÍFONOS!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 50, 'w': 35.52631578947364, 'x': 32.631578947368425, 'y': -0.5660377358490566}, 'character_refs': ['Peggy']}, {'id': 1548, 'page_number': 4, 'order_in_page': 0, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Mostrar el contraste entre el interior y el exterior. Emoción: Tensión. Elemento visual: Piso 5 iluminado con luces RGB.\n\n"Exterior view of a 6-story condominium at night, focusing on the 5th floor illuminated with vibrant RGB lights while the other floors are dark. The scene captures a cozy yet chaotic atmosphere with details like stacked books in disarray, snack remnants, a Rika Cocola drink, and a webcam perched on a monitor. The angle is slightly tilted upward to emphasize the glowing window, creating a dynamic composition. The style is a colorful, organic comic book aesthetic with dynamic line work, clean outlines, soft shading, and bright highlights, reflecting a youthful vibe. The background is minimalist to keep the focus on the illuminated window."', 'scene_description': 'Se muestra el piso 5 de un condominio por fuera iluminado con las luces RGB, pero los demás pisos apagados.', 'image_url': 'generated/255ef944-d5fc-4a84-9b6f-a046570caec3.png', 'status': 'completed', 'balloons': [{'text': 'El quinto piso brilla con luces RGB, mientras los demás pisos permanecen en la oscuridad.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 100, 'w': 100, 'x': 0, 'y': 0}, 'character_refs': []}, {'id': 1542, 'page_number': 1, 'order_in_page': 0, 'prompt': "NARRATIVE PURPOSE: Propósito subyacente: Establecer el contexto y la atmósfera de la historia. Emoción: Soledad y misterio. Elemento visual: La habitación iluminada en la noche.\n\nExterior view of Marie's apartment in a six-story condominium at night. The fifth floor is illuminated with bright white light, showcasing a cozy yet slightly chaotic room. Other floors also have lights on, hinting at life within the building. The scene captures the essence of a vibrant urban environment, with clean outlines and a dynamic composition. The angle is slightly tilted upward, emphasizing the height of the building and creating a sense of depth. The color palette is vibrant, with soft shading and bright highlights, reflecting a youthful and organic comic book aesthetic. The background is minimalist, focusing on the structure of the condominium while maintaining a lively atmosphere.", 'scene_description': 'Se ve la habitación de Marie por fuera, encendida (Luz blanca) en medio de la noche. En un condominio de 6 pisos, algunos de los demás pisos también se encuentran encendidos. Ella vive en el 5to piso.', 
        'image_url': 'generated/87207efb-ca40-4fb1-acf0-2a3f4f53e9c9.png', 
        'status': 'completed', 
        'balloons': [{'text': 'Es de noche en Los Olivos. La habitación de Marie brilla en el quinto piso del condominio.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 95.76271349552673, 'w': 95.76271349552671, 'x': -0.5263157894736842, 'y': 1.509433962264151}, 'character_refs': []}, {'id': 1533, 'page_number': 2, 'order_in_page': 3, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Capturar la concentración de Peggy. Emoción: Impaciencia y determinación. Elemento visual: Peggy en su habitación con luces RGB.\n\n**Prompt Visual Final:**\n\n"Full-body shot of Peggy Fresa in her messy bedroom, showing a focused and impatient expression as she grips a gaming mouse. The scene is viewed from the perspective of her computer, capturing her dynamic pose. The room is illuminated by bright white light, highlighting a poster of Nikola Tesla on the wall and a shelf filled with video game consoles. The background features disorganized stacks of books, snack remnants, and a Rika Cocola drink, with a webcam perched on the monitor. Peggy, appearing 21 years old, has a disheveled look, wearing a vibrant fuchsia and white gaming chair, with headphones featuring cute animal ears resting on her head. The overall aesthetic is a colorful, youthful comic manga style with clean outlines, soft shading, and a minimalist background, maintaining an organic comic book feel."', 'scene_description': 'Peggy se ve a cuerpo completo en su habitación con una expresión de concentración e impaciencia, con la mano en el mouse. La vista es desde la computadora. Se observa un póster de Nikola Tesla en la pared y unas consolas de videojuegos en un estante.', 'image_url': 'generated/d8b7454c-62fc-47f7-a8e0-284b32c77cd8.png', 'status': 'completed', 'balloons': [{'text': '¡A POR EL NUEVO PASE DE BATALLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 49.99999999999996, 'w': 99.73684210526302, 'x': -0.6578947368421052, 'y': 51.03773584905652}, 'character_refs': ['Peggy']}, {'id': 1549, 'page_number': 4, 'order_in_page': 1, 'prompt': "**Prompt:** A dynamic comic panel depicting the interior of Marie's bedroom at night, showcasing vibrant RGB lights illuminating the fifth floor of the condominium. The scene captures three characters exiting the room: Marie, a 16-year-old Peruvian girl with long, naturally wavy hair, dressed in a comfortable t-shirt and pajama pants, looking nervous; Peggy, one of Marie's personalities, appearing 21 years old with a messy look, wearing a fuchsia and white gamer chair, holding a mouse and wearing headphones with ears, looking furious; and another version of Peggy, focused and competitive, with a gaming controller in hand and a sword from the game 'Matanite'. The background is minimalist, with disorganized stacks of books and snack remnants, emphasizing the emotional tension. The composition should have clean outlines, soft shading, and bright highlights, capturing expressive character poses in a youthful comic manga style. The panel should be 100% wide and 50% high (16:9 aspect ratio).", 'scene_description': 'Caritas de Marie nerviosa, Peggy furiosa y Peggy concentrada se observan saliendo del cuarto de Marie.', 'image_url': 'generated/a9aa98fb-121a-46cc-b837-5b74122a3835.png', 'status': 'completed', 'balloons': [{'text': '*Risa nerviosa*', 'type': 'dialogue', 'character': 'Marie', 'position_hint': 'top-left'}, {'text': '¡No puedo perderme esto!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'text': '¡Vamos, vamos, vamos!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 50, 'w': 100, 'x': 0, 'y': 50}, 'character_refs': ['Marie', 'Peggy']}, {'id': 1532, 'page_number': 2, 'order_in_page': 2, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Resaltar la atmósfera de juego. Emoción: Anticipación. Elemento visual: Control de luces RGB.\n\n**Prompt Visual Final:**\n\n"Inside Marie\'s bedroom at night, a dynamic comic book scene featuring Peggy Fresa, a 21-year-old personality of Marie, sitting in a vibrant pink and white gaming chair at Marie\'s cluttered desk. She has messy hair and wears tech gadgets, with RGB light control in hand, pressing the power button. The room is illuminated by a bright white light from the computer screen, casting soft shadows. The background is minimalist, showing a disorganized stack of books, snack remnants, and a Rika Cocola drink. The camera angle is slightly tilted from above, emphasizing Peggy\'s focused expression as she prepares to play, with clean outlines and a vibrant color palette, capturing the organic comic book aesthetic in a youthful, dynamic style."', 'scene_description': 'Una mano presionando el botón de encendido de un control de luces RGB.', 'image_url': 'generated/0857d8de-381f-41c8-9757-ec5339f4ac94.png', 'status': 'completed', 'balloons': [{'text': '¡LUCES!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 49.99999999999989, 'w': 30.394736842105257, 'x': 70.65789473684211, 'y': 0.37735849056584464}, 'character_refs': ['Peggy']}, {'id': 1543, 'page_number': 1, 'order_in_page': 1, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Mostrar el desorden y la personalidad de Marie. Emoción: Caos y desorganización. Elemento visual: Escritorio desordenado con libros y snacks.\n\n**Prompt Visual Final:**\n\n"Interior of Marie\'s bedroom at night, featuring a messy desk cluttered with stacked science books and scattered snack remnants. A can of Rika Cocola is prominently displayed. The room is illuminated by a warm white light, creating a cozy yet chaotic atmosphere. The angle of the camera is slightly tilted to capture the disarray of the desk and the vibrant colors of the books. The background is minimalist, emphasizing the organic comic book aesthetic with dynamic line work, clean outlines, and soft shading. The scene should convey a youthful, relatable vibe, reflecting Marie\'s inner turmoil and her use of humor and gaming as an escape."', 'scene_description': 'En el interior de la habitación, se muestra un escritorio con algunos libros apilados de forma desordenada y restos de snacks por doquier. Los libros son de ciencias. También está presente la bebida Rika Cocola.', 'image_url': 'generated/034e4d16-9ca6-4329-b79c-19891a9b9a26.png', 'status': 'completed', 'balloons': [{'text': 'Dentro, el escritorio está desordenado, lleno de libros de ciencias y restos de snacks.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 20.822615304016708, 'w': 46.565342241049976, 'x': 53.566236706318385, 'y': 43.04530922428519}, 'character_refs': []}, {'id': 1530, 'page_number': 2, 'order_in_page': 0, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Presentar a Peggy y su entusiasmo. Emoción: Alegría y emoción. Elemento visual: Peggy sentándose en su silla gamer.\n\n**Prompt Visual Final:**\n\n"Interior de la habitación de Marie, de noche. Peggy Fresa, una joven de 21 años con un estilo desenfadado y despeinado, está sentada en una silla gamer de colores fucsia con blanco, concentrada en su computadora gamer encendida en el centro del escritorio. La luz blanca ilumina suavemente la habitación, resaltando los detalles de un ambiente desordenado con libros apilados y restos de snacks. La webcam se encuentra encima del monitor, y una bebida Rika Cocola está visible. La composición debe ser dinámica, con un ángulo de cámara ligeramente en picado que capture la intensidad de Peggy mientras juega, mostrando su lado competitivo. Estilo de cómic manga juvenil, con líneas dinámicas, paleta de colores vibrantes, contornos limpios y un fondo minimalista que enfatiza la acción. La escena debe transmitir la energía y la personalidad sarcástica de Peggy."', 'scene_description': 'Peggy se sienta sobre su cómoda silla gamer de colores fucsia con blanco.', 'image_url': 'generated/d098713f-02ae-4fef-bcf8-0e7c3f3f7f3b.png', 'status': 'completed', 'balloons': [{'text': '¡SILLA!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 49.999999999999986, 'w': 31.31578947368422, 'x': -1.0526315789473675, 'y': -0.28301886792452935}, 'character_refs': ['Peggy']}, {'id': 1544, 'page_number': 1, 'order_in_page': 2, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Introducir el equipo gamer de Peggy. Emoción: Expectativa. Elemento visual: Computadora gamer encendiéndose.\n\n**Prompt Visual Final:**\n\n"Interior of Marie\'s bedroom at night, featuring a white gaming computer in the center of a cluttered desk. The computer is powering on, casting a soft white glow. A hand hovers over the monitor\'s power button. Above the screen, a webcam is positioned. The room is illuminated by the computer\'s light, highlighting scattered books, snack remnants, and a Rika Cocola drink. The atmosphere is cozy yet chaotic, with a minimalist background emphasizing the desk\'s disarray. The scene is drawn in a dynamic comic manga style with vibrant colors, clean outlines, and soft shading, capturing a youthful aesthetic. The angle of the camera is slightly tilted downwards, focusing on the desk and the glowing computer, creating an engaging and immersive composition."', 'scene_description': 'Al centro del escritorio, una computadora blanca encendiéndose y una mano sobre el botón de encendido del monitor blanco. La computadora es de estilo gamer. Hay una webcam encima de la pantalla del monitor.', 'image_url': 'generated/19127430-6d58-447a-8eb7-afae8c7d6206.png', 'status': 'completed', 'balloons': [{'text': 'Una computadora gamer se enciende, lista para la acción.', 'type': 'narration', 'character': None, 'position_hint': 'top-center'}], 'layout': {'h': 14.395122111351979, 'w': 37.471105560184036, 'x': 61.90695475307374, 'y': 65.8208831885799}, 'character_refs': []}, {'id': 1547, 'page_number': 3, 'order_in_page': 2, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Capturar la intensidad del juego. Emoción: Caos y energía. Elemento visual: Peggy jugando con gestos exagerados.\n\n**Prompt Visual Final:**\n\n"Interior of Marie\'s bedroom at night, illuminated by a bright white light. The scene captures a dynamic moment where Peggy, a 21-year-old playful and sarcastic personality of Marie, is intensely focused on playing a video game, her messy hair and gamer chair in vibrant fuchsia and white. She holds a gaming mouse in one hand and a \'Matanite\' sword in the other, with RGB lights glowing around her. Marie, a 16-year-old Peruvian girl with long, naturally wavy hair, sits beside her in comfortable pajamas, looking concerned as she gestures to calm Peggy down. The background features a cluttered desk with stacked books, snack remnants, and a Rika Cocola drink, while a webcam sits atop the monitor. The panel is designed in a 16:9 aspect ratio with dynamic line work, vibrant colors, clean outlines, soft shading, and expressive character poses, creating an organic comic book aesthetic."', 'scene_description': 'Mientras Peggy se encuentra jugando muy concentrada, en su mente ella se mueve escandalosamente gritando. Marie, a su lado, hace gestos para tratar de apaciguarla.', 'image_url': 'generated/995d9b22-807a-4426-b765-306bcd152bc4.png', 'status': 'completed', 'balloons': [{'text': '¡Arriba! ¡Construye! ¡Dispara! ¡Farmea boobooo!!!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}, {'text': '*Risa nerviosa*', 'type': 'dialogue', 'character': 'Marie', 'position_hint': 'top-left'}], 'layout': {'h': 71.96144400655346, 'w': 98.79858402641442, 'x': -0.3947368421052622, 'y': 24.339622641509433}, 'character_refs': ['Peggy', 'Marie']}, {'id': 1546, 'page_number': 3, 'order_in_page': 1, 'prompt': 'NARRATIVE PURPOSE: Propósito subyacente: Mostrar la reacción de Peggy ante el juego. Emoción: Frustración. Elemento visual: Primer plano de la mirada de Peggy.\n\n**Prompt Visual Final:**\n\n"Close-up shot of Peggy\'s intense gaze, showcasing her competitive spirit as she plays a video game. The scene is set in Marie\'s bedroom, illuminated by a warm white light, creating a cozy yet focused atmosphere. Peggy, appearing 21 years old, has a messy hairstyle and a casual, slightly disheveled look. She wears a vibrant fuchsia and white gamer chair, with a gaming mouse in her hand and oversized headphones with ears resting on her head. The background features a cluttered desk with stacked books, snack remnants, and a Rika Cocola drink, emphasizing her laid-back personality. The angle captures her expressive face, highlighting her determination and playful sarcasm, with soft shading and bright highlights to enhance the organic comic book aesthetic. The panel is designed in a 16:9 aspect ratio."', 'scene_description': 'Un primer plano a la mirada de Peggy.', 'image_url': 'generated/45854bf6-2f23-455c-ac56-9c3e00e93c09.png', 'status': 'completed', 'balloons': [{'text': '¡Tch!', 'type': 'dialogue', 'character': 'Peggy', 'position_hint': 'bottom-center'}], 'layout': {'h': 21.698113207547173, 'w': 53.289473684210485, 'x': 46.578947368420906, 'y': 1.3406466712454721e-15}, 'character_refs': ['Peggy']}], 'global_context': {'style_guide': 'Cómic Manga a color juvenil, dinámico pero sin fantasía.', 'characters': [{'name': 'Marie', 'description': 'Nombre:\tMarie Rosas\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t07/11/2000\r\nEspecialidad:\t3x3, Megaminx, Square-1, cuboides\r\nCaracterísticas:\tCabello largo, naturalmente ondeado pero le gusta plancharlo, viste chompas o poleras manga larga y pantalones jean.\r\nPersonalidad:\r\nCuriosa, investigadora, gamer, tímida, sencilla, bromista y algo soberbia. El horrible pasado con su padre y las tendencias suicidas la atormentan. Sufre de TID (Transtorno de identidad disociativo) que la lleva a tener 5 personalidades, de las cuales solo es consciente de 3. Una decepción amorosa endurece su corazón. Le gusta comer, ver películas, series, la ciencia y sobretodo le llaman mucho la atención los cubos más extraños. Posee lagunas mentales', 'metadata': {}, 'image_url': 'projects/c195e65c-601c-45cc-ac23-3e42696c31a1/characters/Marie_Rosas.jpg', 'image_urls': ['projects/c195e65c-601c-45cc-ac23-3e42696c31a1/characters/Marie_Rosas.jpg', 'projects/c195e65c-601c-45cc-ac23-3e42696c31a1/characters/17/refs/Marie_Frente.jpg']}, {'name': 'Peggy', 'description': 'Nombre:\tPeggy Fresa\tSexo:\tFemenino\r\nNacionalidad:\tPeruana\tFecha de Nacimiento:\t08/12/2002\r\nEspecialidad:\tVideojuegos, Matanite.\r\nCaracterísticas:\tDespeinada y descuidada. Usa gadgets tecnológicos.\r\nPersonalidad:\r\nSiempre divertida y sarcástica. Trata de ser ruda pero no es lo suficiente. Se concentra y enoja exageradamente al jugar videojuegos, pero es de las mejores. Le encantan los animales.', 'metadata': {}, 'image_url': 'projects/c195e65c-601c-45cc-ac23-3e42696c31a1/characters/DdP_Peggy_Fresa_1.jpg', 'image_urls': ['projects/c195e65c-601c-45cc-ac23-3e42696c31a1/characters/DdP_Peggy_Fresa_1.jpg']}], 'sceneries': [{'name': 'Casa de Marie', 'description': 'Condominio de 6 pisos donde Marie vive en el 5to piso ubicado en un barrio en los olivos Lima Perú', 'metadata': {}, 'image_url': 'projects/c195e65c-601c-45cc-ac23-3e42696c31a1/sceneries/condominio.jpg', 'image_urls': ['projects/c195e65c-601c-45cc-ac23-3e42696c31a1/sceneries/condominio.jpg']}, {'name': 'Interior habitación de Marie', 'description': 'Cuarto de chica que tiene una cama central, un escritorio donde se ubica su computadora gamer color blanco y una silla gamer rosada', 'metadata': {}, 'image_url': 'projects/c195e65c-601c-45cc-ac23-3e42696c31a1/sceneries/habitacion.jpg', 'image_urls': ['projects/c195e65c-601c-45cc-ac23-3e42696c31a1/sceneries/habitacion.jpg']}]}}

def run_test():
    print("Iniciando prueba local del agente...")
    # El contexto puede ser un objeto vacío para simular Lambda/Bedrock
    context = {}
    
    result = agent_invocation(payload, context)
    
    print("\n--- RESULTADO DEL AGENTE ---")
    print(json.dumps(result, indent=2))

if __name__ == "__main__":
    run_test()